{"version":3,"sources":["payments.es6"],"names":[],"mappings":";;AAAA,SAAS,gBAAT,CAA0B,CAA1B,EAA2C;QAAd,iEAAS,mBAAK;;AACvC,QAAM,eAAe,EAAE,gBAAF,CAAf,CADiC;AAEvC,QAAM,sBAAsB,EAAE,iBAAF,CAAtB,CAFiC;AAGvC,QAAM,iBAAiB,EAAE,kBAAF,CAAjB,CAHiC;AAIvC,QAAM,gBAAgB,EAAE,sBAAF,CAAhB,CAJiC;AAKvC,QAAM,mBAAmB,EAAE,0BAAF,CAAnB,CALiC;AAMvC,QAAM,WAAW,WAAW,MAAX,CANsB;;AAQvC,iBAAa,EAAb,CAAgB,OAAhB,EAAyB,GAAzB,EAA8B,UAAC,CAAD,EAAO;AACjC,YAAM,MAAM,EAAE,EAAE,MAAF,CAAF,CAAY,IAAZ,CAAiB,MAAjB,CAAN,CAD2B;AAEjC,UAAE,cAAF,GAFiC;AAGjC,UAAE,OAAF,CAAU,WAAW,GAAX,EAAgB,UAAC,IAAD,EAAU;AAChC,mBAAO,IAAP,EADgC;AAEhC,oBAAQ,SAAR,CAAkB,IAAlB,EAAwB,KAAK,KAAL,EAAY,GAApC,EAFgC;SAAV,CAA1B,CAHiC;KAAP,CAA9B,CARuC;;AAiBvC,iBAAa,EAAb,CAAgB,QAAhB,EAA0B,WAA1B,EAAuC,UAAC,CAAD,EAAO;AAC1C,YAAM,MAAM,MAAM,EAAE,EAAE,MAAF,CAAF,CAAY,SAAZ,EAAN,CAD8B;AAE1C,UAAE,cAAF,GAF0C;AAG1C,UAAE,OAAF,CAAU,WAAW,GAAX,EAAgB,UAAC,IAAD,EAAU;AAChC,mBAAO,IAAP,EADgC;AAEhC,oBAAQ,SAAR,CAAkB,IAAlB,EAAwB,KAAK,KAAL,EAAY,GAApC,EAFgC;SAAV,CAA1B,CAH0C;KAAP,CAAvC,CAjBuC;;AA0BvC,WAAO,UAAP,GAAoB,UAAS,CAAT,EAAY;AAC5B,YAAI,EAAE,KAAF,CAAQ,QAAR,EAAkB;AAClB,cAAE,cAAF,GADkB;AAElB,mBAAO,EAAE,KAAF,CAAP,CAFkB;SAAtB;KADgB,CA1BmB;;AAiCvC,aAAS,MAAT,CAAgB,IAAhB,EAAsB;AAClB,uBAAe,IAAf,CAAoB,cAAc,IAAd,CAApB,EADkB;AAElB,4BAAoB,IAApB,CAAyB,WAAW,IAAX,CAAzB,EAFkB;AAGlB,mBAAW,IAAX,EAHkB;KAAtB;;AAMA,aAAS,aAAT,CAAuB,IAAvB,EAA6B;AACzB,YAAM,OAAO,EAAP,CADmB;AAEzB,YAAI,KAAK,UAAL,CAAgB,MAAhB,GAAyB,CAAzB,EAA4B;AAC5B,iBAAK,IAAL,CAAU,YAAY,KAAK,UAAL,CAAZ,CAA6B,CAA7B,CAAV,EAD4B;SAAhC;6CAFyB;;;;;AAKzB,iCAAqB,KAAK,QAAL,0BAArB,oGAAoC;oBAA1B,sBAA0B;;AAChC,qBAAK,IAAL,CAAU,gBAAgB,OAAhB,EAAyB,CAAzB,CAAV,EADgC;aAApC;;;;;;;;;;;;;;SALyB;;AAQzB,eAAO,EAAE,IAAF,CAAP,CARyB;KAA7B;;AAWA,aAAS,UAAT,CAAoB,IAApB,EAA0B;AACtB,YAAI,KAAK,WAAL,IAAoB,CAApB,EAAuB;AACvB,mBAAO,EAAP,CADuB;SAA3B;AAGA,YAAM,OAAO,oBAAoB,KAAK,SAAL,EAAgB,4CAApC,CAAP,CAJgB;AAKtB,YAAM,OAAO,oBAAoB,KAAK,SAAL,EAAgB,4CAApC,CAAP,CALgB;AAMtB,YAAM,QAAQ,EAAR,CANgB;AAOtB,cAAM,IAAN,CAAW,KAAK,CAAL,CAAX,EAPsB;;;;;;AAQtB,kCAAkB,KAAK,UAAL,2BAAlB,wGAAmC;oBAAzB,oBAAyB;;AAC/B,sBAAM,IAAN,CAAW,oBAAoB,IAApB,EAA0B,CAA1B,CAAX,EAD+B;aAAnC;;;;;;;;;;;;;;SARsB;;AAWtB,cAAM,IAAN,CAAW,KAAK,CAAL,CAAX,EAXsB;AAYtB,eAAO,EAAE,KAAF,CAAP,CAZsB;KAA1B;;AAeA,aAAS,UAAT,CAAoB,IAApB,EAA0B;AACtB,sBAAc,GAAd,CAAkB,KAAK,cAAL,CAAlB,CADsB;AAEtB,yBAAiB,QAAjB,GAA4B,MAA5B,CAAmC,WAAnC,EAAgD,IAAhD,CAAqD,KAAK,iBAAL,KAA2B,CAA3B,GAA+B,qBAA/B,GAAuD,mBAAvD,CAArD,CAFsB;AAGtB,yBAAiB,GAAjB,CAAqB,KAAK,iBAAL,CAArB,CAHsB;KAA1B;;AAMA,aAAS,MAAT,CAAgB,EAAhB,EAAoB;AAChB,eAAO,EAAE,MAAF,EAAU,QAAV,CAAmB,eAAnB,CAAP,CADgB;KAApB;;AAIA,aAAS,MAAT,CAAgB,IAAhB,EAAsB;AAClB,eAAO,EAAE,MAAF,EAAU,QAAV,CAAmB,kBAAnB,EAAuC,IAAvC,CAA4C,IAA5C,CAAP,CADkB;KAAtB;;AAIA,aAAS,QAAT,CAAkB,IAAlB,EAAwB,QAAxB,EAAkC;AAC9B,eAAO,EAAE,QAAF,EAAY,QAAZ,CAAqB,QAArB,EAA+B,IAA/B,CAAoC,IAApC,CAAP,CAD8B;KAAlC;;AAIA,aAAS,kBAAT,CAA4B,MAA5B,EAAoC;AAChC,YAAM,MAAM,OAAO,EAAP,CAAN,CAD0B;AAEhC,aAAI,IAAI,IAAI,CAAJ,EAAO,IAAI,CAAJ,EAAO,GAAtB,EAA2B;AACvB,gBAAI,MAAJ,CAAW,SAAS,CAAT,EAAY,mCAAmC,CAAnC,IAAwC,KAAK,MAAL,IAAe,KAAf,CAAxC,CAAvB,EADuB;SAA3B;AAGA,eAAO,GAAP,CALgC;KAApC;;AAQA,aAAS,eAAT,CAAyB,EAAzB,EAA6B;AACzB,YAAM,MAAM,OAAO,EAAP,CAAN,CADmB;AAEzB,YAAI,MAAJ,CAAW,OAAO,GAAG,QAAH,CAAlB,EAFyB;AAGzB,YAAI,MAAJ,CAAW,mBAAmB,GAAG,WAAH,CAA9B,EAHyB;AAIzB,YAAI,MAAJ,CAAW,OAAO,GAAG,GAAH,CAAlB,EAJyB;AAKzB,YAAI,MAAJ,CAAW,OAAO,MAAM,GAAG,MAAH,CAAxB,EALyB;AAMzB,eAAO,GAAP,CANyB;KAA7B;;AASA,aAAS,WAAT,CAAqB,IAArB,EAA2B;AACvB,eAAQ,EAAE,MAAF,EAAU,MAAV,CAAiB,EAAE,MAAF,EAAU,IAAV,CAAe,SAAf,EAA0B,CAA1B,EAA6B,IAA7B,CAAkC,IAAlC,CAAjB,CAAR,CADuB;KAA3B;;AAIA,aAAS,KAAT,CAAe,CAAf,EAAkB;AACd,YAAM,MAAO,EAAE,KAAF,EACR,IADQ,CACH,MADG,EACK,EAAE,GAAF,CADL,CAER,IAFQ,CAEH,EAAE,IAAF,CAFJ,CADQ;AAId,YAAG,EAAE,MAAF,EAAU;AACT,gBAAI,QAAJ,CAAa,QAAb,EADS;SAAb;AAGA,YAAG,EAAE,QAAF,EAAY;AACX,gBAAI,IAAJ,CAAS,UAAT,EADW;SAAf;AAGA,eAAO,GAAP,CAVc;KAAlB;;AAaA,aAAS,mBAAT,CAA6B,IAA7B,EAAkE;YAA/B,iEAAS,oCAAsB;;AAC9D,eAAO,EAAE,MAAF,EAAU,MAAV,CAAiB,MAAM,IAAN,EAAY,QAAZ,CAAqB,oBAArB,CAAjB,CAAP,CAD8D;KAAlE;CArHJ","file":"payments.js","sourcesContent":["function startPaymentsApp($, base_url='/') {\n    const AppContainer = $('.tsh-container');\n    const PaginationContainer = $('.tsh-pagination');\n    const PagesContainer = $('.tsh-table>tbody');\n    const SupplierInput = $('input[name=supplier]');\n    const CostRatingSelect = $('select[name=cost_rating]');\n    const json_url = base_url + 'json';\n\n    AppContainer.on('click', 'a', (e) => {\n        const url = $(e.target).attr('href');\n        e.preventDefault();\n        $.getJSON(json_url + url, (data) => {\n            update(data);\n            history.pushState(data, data.title, url);\n        });\n    });\n\n    AppContainer.on('submit', '.tsh-form', (e) => {\n        const url = '?' + $(e.target).serialize();\n        e.preventDefault();\n        $.getJSON(json_url + url, (data) => {\n            update(data);\n            history.pushState(data, data.title, url);\n        });\n    });\n\n    window.onpopstate = function(e) {\n        if (e.state.payments) {\n            e.preventDefault();\n            update(e.state);\n        }\n    };\n\n    function update(data) {\n        PagesContainer.html(parsePayments(data));\n        PaginationContainer.html(parseLinks(data));\n        updateForm(data);\n    }\n\n    function parsePayments(data) {\n        const rows = [];\n        if (data.query_info.length > 0) {\n            rows.push(tag_tr_info(data.query_info)[0]);\n        }\n        for(const payment of data.payments) {\n            rows.push(tag_tr_payments(payment)[0]);\n        }\n        return $(rows);\n    }\n\n    function parseLinks(data) {\n        if (data.total_pages == 0) {\n            return '';\n        }\n        const prev = tag_pagination_item(data.prev_link, 'tsh-pagination-btn tsh-pagination-btn-prev');\n        const next = tag_pagination_item(data.next_link, 'tsh-pagination-btn tsh-pagination-btn-next');\n        const links = [];\n        links.push(prev[0]);\n        for(const link of data.page_links) {\n            links.push(tag_pagination_item(link)[0]);\n        }\n        links.push(next[0]);\n        return $(links);\n    }\n\n    function updateForm(data) {\n        SupplierInput.val(data.query_supplier);\n        CostRatingSelect.children().filter('[value=0]').html(data.query_cost_rating === 0 ? 'Select pound rating' : 'All pound ratings');\n        CostRatingSelect.val(data.query_cost_rating);\n    }\n\n    function tag_tr(tr) {\n        return $('<tr>').addClass('tsh-table-row');\n    }\n\n    function tag_td(text) {\n        return $('<td>').addClass('tsh-table-column').text(text);\n    }\n\n    function tag_span(text, cssclass) {\n        return $('<span>').addClass(cssclass).text(text);\n    }\n\n    function tag_td_cost_rating(rating) {\n        const tag = tag_td('');\n        for(let i = 1; i < 6; i++) {\n            tag.append(tag_span(i, 'tsh-rating-ico tsh-rating-ico-' + i + (i <= rating && ' on')));\n        }\n        return tag;\n    }\n\n    function tag_tr_payments(tr) {\n        const tag = tag_tr(tr);\n        tag.append(tag_td(tr.supplier));\n        tag.append(tag_td_cost_rating(tr.cost_rating));\n        tag.append(tag_td(tr.ref));\n        tag.append(tag_td('Â£' + tr.amount));\n        return tag;\n    }\n\n    function tag_tr_info(text) {\n        return  $('<tr>').append($('<td>').attr('colspan', 4).text(text));\n    }\n\n    function tag_a(a) {\n        const tag =  $('<a>')\n            .attr('href', a.url)\n            .html(a.text);\n        if(a.active) {\n            tag.addClass('active');\n        }\n        if(a.disabled) {\n            tag.prop('disabled')\n        }\n        return tag;\n    }\n\n    function tag_pagination_item(item, cssclass=\"tsh-pagination-btn\") {\n        return $('<li>').append(tag_a(item).addClass('tsh-pagination-btn'));\n    }\n}\n"]}